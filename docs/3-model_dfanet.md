# Model Dfanet

[_Documentation generated by Documatic_](https://www.documatic.com)

<!---Documatic-section-Codebase Structure-start--->
## Codebase Structure

<!---Documatic-block-system_architecture-start--->
```mermaid
None
```
<!---Documatic-block-system_architecture-end--->

# #
<!---Documatic-section-Codebase Structure-end--->

<!---Documatic-section-model.dfanet.weight_init-start--->
## [model.dfanet.weight_init](3-model_dfanet.md#model.dfanet.weight_init)

<!---Documatic-section-weight_init-start--->
<!---Documatic-block-model.dfanet.weight_init-start--->
<details>
	<summary><code>model.dfanet.weight_init</code> code snippet</summary>

```python
def weight_init(module):
    for (n, m) in module.named_children():
        if isinstance(m, nn.Conv2d):
            nn.init.kaiming_normal_(m.weight, mode='fan_in', nonlinearity='relu')
            if m.bias is not None:
                nn.init.zeros_(m.bias)
        elif isinstance(m, (nn.BatchNorm2d, nn.InstanceNorm2d)):
            nn.init.ones_(m.weight)
            if m.bias is not None:
                nn.init.zeros_(m.bias)
        elif isinstance(m, nn.Linear):
            nn.init.kaiming_normal_(m.weight, mode='fan_in', nonlinearity='relu')
            if m.bias is not None:
                nn.init.zeros_(m.bias)
        elif isinstance(m, (nn.Sequential, SubBranch, enc, Block, SeparableConv2d, Attention, DFA_Encoder, DFA_Decoder)):
            weight_init(m)
        elif isinstance(m, (nn.ReLU, nn.ReLU, nn.ReLU6)):
            pass
        else:
            pass
```
</details>
<!---Documatic-block-model.dfanet.weight_init-end--->
<!---Documatic-section-weight_init-end--->

# #
<!---Documatic-section-model.dfanet.weight_init-end--->

<!---Documatic-section-model.dfanet.load_backbone-start--->
## [model.dfanet.load_backbone](3-model_dfanet.md#model.dfanet.load_backbone)

<!---Documatic-section-load_backbone-start--->
<!---Documatic-block-model.dfanet.load_backbone-start--->
<details>
	<summary><code>model.dfanet.load_backbone</code> code snippet</summary>

```python
def load_backbone(dfanet, backbone_path):
    print('loading pretrained model....')
    bk_params = torch.load(backbone_path)
    df_params = dfanet.state_dict()
    bk_keys = bk_params.keys()
    for key in bk_keys:
        if key.split('.')[0] == 'conv1':
            new_key = 'encoder.' + key
            if df_params[new_key].size() == bk_params[key].size():
                df_params[new_key] = bk_params[key]
        if 'branch' in key.split('.'):
            new_key = 'encoder.' + key
            new_key = new_key.replace('branch', 'branch0')
            if bk_params[key].size() == df_params[new_key].size():
                df_params[new_key] = bk_params[key]
            else:
                print('uninit ', new_key)
            new_key = new_key.replace('branch0', 'branch1')
            if bk_params[key].size() == df_params[new_key].size():
                df_params[new_key] = bk_params[key]
            else:
                print('uninit ', new_key)
            new_key = new_key.replace('branch1', 'branch2')
            if bk_params[key].size() == df_params[new_key].size():
                df_params[new_key] = bk_params[key]
            else:
                print('uninit ', new_key)
    dfanet.load_state_dict(df_params)
    return dfanet
```
</details>
<!---Documatic-block-model.dfanet.load_backbone-end--->
<!---Documatic-section-load_backbone-end--->

# #
<!---Documatic-section-model.dfanet.load_backbone-end--->

[_Documentation generated by Documatic_](https://www.documatic.com)